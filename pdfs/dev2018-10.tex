\input devHead.tex
\SetTheme{AnnArbor} %10
\title{ソフトウェア開発\\第9回目授業}
\author{平野 照比古}
\institute{}
\date{2018/11/30}
\newtheorem{Prob}{解説}
\newcommand{\Elm}[1]{\texttt{<#1>}}
\setbeamercovered{transparent}

\newcommand{\DOMM}{\texttt}
\newcommand{\Event}{\texttt}
\newcommand{\DOMP}{\texttt}
\newcommand{\DOM}{\texttt{DOM}}
\newcommand{\keyitem}{\relax}
\newcommand{\HTML}{HTML文書}
\begin{document}
\section{前回のレポートから}
 \subsection{問1}
	\begin{frame}[containsverbatim]
	 \begin{itemize}
		\item \texttt{if(変数)}の動作の確認がない、または間違っている内容のものが多かっ
	た。
		\item 基本的には3項演算子\texttt{?}を用いればよい。
		\item \Verb+print("0"?"true":"false");+などと書けばよい。
		\item ルーブリックに挙げた例はJavaScriptとPHPで結果が異なる。
	 \end{itemize}
 	\end{frame}
	
 \section{サーバーとのデータ－の交換}
 \subsection{サーバーとのデータ交換の基本}
 \begin{frame}[containsverbatim]
 \frametitle{サーバーとのデータ交換の基本}
 Webページにおいてサーバーにデータを送る方法には\texttt{POST}と
 \texttt{PUT}の2通りの方法がある。
 \end{frame}
 \begin{frame}[containsverbatim]
 \frametitle{\texttt{POST}による送信}
 \texttt{windows.onload =function()}内に次のコードを追加する。
 \begin{verbatim}
    var Form = document.getElementsByTagName("form")[0];
    Form.setAttribute("method","POST");
    Form.setAttribute("action","09sendData.php");
 \end{verbatim}
 HTMLの要素に対しては次のことを行う。
 \begin{itemize}
 \item \texttt{<select>}要素の属性に\verb+name="select"+ を追加する。
 \item \texttt{id}が\verb+"colorName"+であるテキストボックスに
       \verb+name="colorName"+ を追加する。
 \item 「設定」ボタンの要素の後に次の要素を追加する。
 \begin{center}
 \verb+<input type="submit" value="送信" id="Send"></input>+ 
 \end{center}
 \end{itemize}
 \end{frame}
 \begin{frame}[containsverbatim]
 \frametitle{\texttt{POST}による送信(解説)}
 \begin{itemize}
 \item このページでは「送信」ボタンを押すと\texttt{<form>}の
 \texttt{action}属性で指定されたプログラムが呼び出される。
 \item ここではWebペー ジと同じ場所にある\texttt{09sendData.php}が呼び出
      される。
 \end{itemize}
 \end{frame}
 \begin{frame}[containsverbatim]
 \frametitle{サーバープログラムのリスト}
 {\scriptsize
 \begin{listing}{1}
 <?php
 print <<<_EOL_
 <!DOCTYPE html>
 <head>
 <meta charset="UTF-8"/>
 <title>サーバーに送られたデータ</title>
 </head>
 <body>
 <table>
 _EOL_;
 foreach($_POST as $key=>$value) {
  print "<tr><td>$key</td><td>$value</td></tr>\n";
 }
 print <<<_EOL_
 </table>
 </body>
 </html>
 _EOL_;
 ?>
 \end{listing}
 }
 \end{frame}
 \begin{frame}[containsverbatim]
 \frametitle{サーバープログラムのリスト(解説)}
 \begin{itemize}
 \item 2行目から10行目の間はヒアドキュメント形式でHTML文書の初めの部分を
       出力させている。
 \item \verb+method="POST"+で呼び出されたときには\texttt{form}要素内の
       \texttt{name}属性が指定されたものの値がスーパーグローバル
       \verb+$_POST+内の連想配列としてアクセスができる。
 \item 11行目から13行目でそれらの値を\texttt{table}要素内の要素として出
       力している。
 \end{itemize}
 \end{frame}
 \begin{frame}[containsverbatim]
 \frametitle{サーバープログラムのリスト(ソース)}
 \begin{verbatim}
 <!DOCTYPE html>
 <head>
 <meta charset="UTF-8"/>
 <title>サーバーに送られたデータ</title>
 </head>
 <body>
 <table><tr><td>select</td><td>yellow</td></tr>
 <tr><td>color</td><td>green</td></tr>
 <tr><td>colorName</td><td>gray</td></tr>
 </table>
 </body>
 </html>
 \end{verbatim}
 \end{frame}
 \begin{frame}[containsverbatim]
 \frametitle{\texttt{GET}による通信}
 \begin{itemize}
 \item \verb+method="PUT"+で呼び出した場合にはスーパーグローバル
 \verb+$_GET+を用いる。
 \item スーパーグローバル\verb+$_REQUEST+は
 \verb+method="POST"+でも\verb+method="PUT"+で呼び出された場合の
 \verb+$_POST+や\verb+$_GET+の代わりに使用できる。
 \end{itemize}
 \end{frame}
 \begin{frame}[containsverbatim]
 \frametitle{通信に関する注意}
 \begin{itemize}
 \item \verb+type="submit"+の\texttt{input}要素は、ボタンが押されたときに直ちに、
 \texttt{action}属性で指定された処理が呼び出される。
 \item サーバーにデータを送る前に最低限のエラーチェックを行い、エラーが
       ない場合にだけサーバーと通信するのが良い。
 \end{itemize}
 \end{frame}
 \begin{frame}[containsverbatim]
 \frametitle{スパーグローバルの補足}
 \begin{itemize}
 \item {\texttt{\$\_SERVER}}\\
 サーバーにアクセスしたときのクライ
 アントの情報などを提供。具体的な内容はクライアントごとに異なる。
 \item \texttt{\$\_COOKIE}\\
 COOKIE とはWebサーバー側からクライアント側に一時的にデータを保存させる仕
 組み。すでに訪問したことがあるサイトに対して情報を開始
 時に補填する機能などを実現できる。
 \item \texttt{\$\_SESSION}\\
 セッションとはある作業の一連の流れを指す。たとえば会員制のサイトではログイ
 ン後でなければページを見ることができない。情報のページに直接行くことがで
 きないような仕組みが必要
 \end{itemize}
 \end{frame}
 \begin{frame}[containsverbatim]
 \frametitle{セッション}
 \begin{itemize}
 \item HTTP通信はセッションレスな通信である（各ページが独立して存在し、ページ間
 のデータを直接渡せない）
 \item セッションを確立するためには、クライアント側から情報を送り、それに基づい
 てサーバー側が状況を判断するなどの操作を意識的にする必要
 \item PHPではセッションを開始するための関数\texttt{session\_start()}とセッショ
 ンを終了させる\texttt{session\_destroy()}が用意されている。
 \item セッションを通じで保存させておきたい情報はこの連想配列に保存
 \item セッションの管理はサーバーが管理
 \item この機能はCOOKIEの機能を利用して実現
 \end{itemize}
 \end{frame}
\begin{frame}[containsverbatim]
 \frametitle{Web Storage}
 \begin{itemize}
 \item localStoarage と sessionStorage の2種類
 \item localStorage は文字列をキーに、文字列の値を持つStorageオブジェク
 ト
 \item 同一の出身(プロトコルやポート番号も含む)のすべてのドキュメント
 がおなじlocalStorageを共有
 \item このデータは意識的に消さない限り存在
 \item sessionStorageはウインドウやブラウザが閉じられると消滅
 \item セッション間の情報の移動を可能にしている。
 \end{itemize}
 \end{frame}
 \begin{frame}[containsverbatim]
 \frametitle{Web Storageの補足}
 \begin{itemize}
 \item いくつかのサイトではこの機能を用いており、その開発者ツールで見る
       ことが可能
 \item データの形式は文字列である。構造化されたデータはJSON形式で保存するのがよい
 \end{itemize}
 \end{frame}
\begin{frame}[containsverbatim]
 \frametitle{WebStrageの例(1)}
 {\small
 \begin{verbatim}
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>WebStorage --- localStorage</title>
\end{verbatim}
 }
 \end{frame}
\begin{frame}[containsverbatim]
 \frametitle{WebStrageの例(2)}
 {\small
  \begin{verbatim}
<script type="text/javascript">
//<![CDATA[
var Storage = window.localStorage;
//var Storage = window.sessionStorage;
window.onload = function() {
  var AccessList, Message = document.getElementById("message");
  var D = new Date();
  if(Storage["access"]) {
    AccessList = JSON.parse(Storage["access"]);
  } else {
    AccessList = [];
    appendMessage(Message, "初めてのアクセスです");
  }
  AccessList.unshift(D.getTime());
  Storage["access"] = JSON.stringify(AccessList);
  appendMessage(Message, "今までのアクセス時間です");
  AccessList.forEach(function(D, i, A) {
    appendMessage(Message, new Date(D));
  });
}
\end{verbatim}
 }
 \end{frame}
\begin{frame}[containsverbatim]
 \frametitle{WebStrageの例(3)}
 {\small
  \begin{verbatim}
function appendMessage(P, Mess) {
  var div = document.createElement("div");
  P.appendChild(div);
  div.appendChild(document.createTextNode(Mess));
}
//]]
</script>
</head>
 \end{verbatim}
 }
\end{frame}
\begin{frame}[containsverbatim]
 \frametitle{WebStrageの例(4)}
 {\small
  \begin{verbatim}
<body>
  <form action="10next.html">
    <input type="submit" value="次のページ"></input>
  </form>
  <div  id="message"/>
</body>
</html>
\end{verbatim}
 }
\end{frame}
\end{document}
